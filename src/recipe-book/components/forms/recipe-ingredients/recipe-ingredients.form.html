<h3 class="form-section-title">Ингредиенты</h3>

<div class="form-field ingredients-servings">
  <span class="form-field__label">
    Количество порций
    <span
      class="form-field__info-icon"
      data-tooltip="Введите общее количество порций, на которое рассчитаны объемы ингредиентов. При сохранении значения будут поделены на это число для получения нормы на 1 порцию."
    >
      ?
    </span>
  </span>
  <recipe-book-number-input
    [class.form-field__input--invalid]="isInvalid(recipeIngredientsForm.servings)"
    [formField]="recipeIngredientsForm.servings"
  />
  <recipe-book-form-errors [field]="recipeIngredientsForm.servings" />
</div>

<div class="ingredients-list">
  @for (ingredient of recipeIngredientsForm.list; track $index) {
    <div class="ingredient-row">
      <div class="ingredient-row__top">
        <div class="form-field ingredient-row__name">
          <span class="form-field__label">Название</span>
          <input
            class="form-field__input"
            placeholder="Например, Мука"
            [class.form-field__input--invalid]="isInvalid(ingredient.name)"
            [formField]="ingredient.name"
          />
        </div>
        <button
          class="ingredient-row__remove"
          title="Удалить ингредиент"
          type="button"
          (click)="removeIngredient($index)"
        >
          ×
        </button>
      </div>

      <div class="ingredient-row__middle">
        @let unit = ingredient.amount.unit();
        @if (unit) {
          <div class="form-field ingredient-row__value">
            <span class="form-field__label">Кол-во</span>
            <recipe-book-number-input
              [class.form-field__input--invalid]="isInvalid(ingredient.amount.value)"
              [formField]="ingredient.amount.value"
              [step]="getStep(value().list[$index].amount.unit)"
            />
          </div>
        }
        <div class="form-field ingredient-row__unit">
          <span class="form-field__label">Ед. изм.</span>
          <recipe-book-dropdown
            placeholder="Выбрать"
            [formField]="ingredient.amount.unit"
            [options]="ingredientUnits"
          />
        </div>
      </div>

      <div class="form-field ingredient-row__note">
        <span class="form-field__label">Примечание</span>
        <input
          class="form-field__input"
          placeholder="Например, просеять или комнатной температуры"
          [formField]="ingredient.note"
        />
      </div>

      <recipe-book-form-errors [field]="ingredient.name" />
      <recipe-book-form-errors [field]="ingredient.amount.value" />
    </div>
  }
  <button class="btn btn-secondary" type="button" (click)="addIngredient()">
    + Добавить ингредиент
  </button>
</div>
